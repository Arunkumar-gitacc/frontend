# name: Frontend CI - Build & Trigger Deploy

# on:
#   push:
#     branches: ["main"]

# permissions:
#   contents: read

# jobs:
#   build:
#     runs-on: ubuntu-latest

#     steps:
#       # 1ï¸âƒ£ Checkout frontend code
#       - name: Checkout code
#         uses: actions/checkout@v4

#       # 2ï¸âƒ£ Login to Docker Hub
#       - name: Login to Docker Hub
#         uses: docker/login-action@v3
#         with:
#           username: ${{ secrets.DOCKER_USERNAME }}
#           password: ${{ secrets.DOCKER_PASSWORD }}

#       # 3ï¸âƒ£ Build frontend Docker image with commit SHA
#       - name: Build frontend image
#         run: |
#           docker build \
#             -t arunkumar885825/frontend:${{ github.sha }} \
#             -t arunkumar885825/frontend:latest \
#             .

#       # 4ï¸âƒ£ Push frontend image
#       - name: Push frontend image
#         run: |
#           docker push arunkumar885825/frontend:${{ github.sha }}
#           docker push arunkumar885825/frontend:latest

#       # 5ï¸âƒ£ Notify deployment repo (trigger CD)
#       - name: Trigger deployment pipeline
#         run: |
#           curl -X POST \
#             -H "Authorization: token ${{ secrets.DEPLOYMENT_REPO_TOKEN }}" \
#             -H "Accept: application/vnd.github.v3+json" \
#             https://api.github.com/repos/arunkumar-gitacc/deployment/dispatches \
#             -d '{
#               "event_type": "frontend_updated",
#               "client_payload": {
#                 "tag": "'"${{ github.sha }}"'"
#               }
#             }'
# name: Frontend CI - Build & Trigger Deploy (with SonarQube)

# on:
#   push:
#     branches:
#       - main

# permissions:
#   contents: read

# jobs:
#   build:
#     runs-on: ubuntu-latest

#     steps:
#       # -----------------------
#       # 1ï¸âƒ£ CHECKOUT CODE
#       # -----------------------
#       - name: Checkout code
#         uses: actions/checkout@v4
#         with:
#           fetch-depth: 0

#       # -----------------------
#       # 2ï¸âƒ£ SETUP NODE (matches legacy projects)
#       # -----------------------
#       - name: Setup Node.js
#         uses: actions/setup-node@v4
#         with:
#           node-version: 18

#       # -----------------------
#       # 3ï¸âƒ£ INSTALL DEPENDENCIES (NO CODE CHANGE)
#       # -----------------------
#       - name: Install dependencies
#         run: npm ci --legacy-peer-deps

#       # -----------------------
#       # 4ï¸âƒ£ RUN TESTS (OPTIONAL, SAFE)
#       # -----------------------
#       - name: Run tests
#         run: npm test -- --coverage
#         continue-on-error: true

#       # -----------------------
#       # 5ï¸âƒ£ SONARQUBE SCAN
#       # -----------------------
#       - name: SonarQube Scan
#         uses: SonarSource/sonarqube-scan-action@v2
#         env:
#           SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
#           SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}

#       # -----------------------
#       # 6ï¸âƒ£ SONARQUBE QUALITY GATE (BLOCK PIPELINE)
#       # -----------------------
#       - name: SonarQube Quality Gate
#         uses: SonarSource/sonarqube-quality-gate-action@v1
#         timeout-minutes: 5
#         env:
#           SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
#           SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}

#       # -----------------------
#       # 7ï¸âƒ£ LOGIN TO DOCKER HUB
#       # -----------------------
#       - name: Login to Docker Hub
#         uses: docker/login-action@v3
#         with:
#           username: ${{ secrets.DOCKER_USERNAME }}
#           password: ${{ secrets.DOCKER_PASSWORD }}

#       # -----------------------
#       # 8ï¸âƒ£ SET IMAGE TAG (SHORT SHA)
#       # -----------------------
#       - name: Set image tag
#         run: echo "IMAGE_TAG=$(git rev-parse --short HEAD)" >> $GITHUB_ENV

#       # -----------------------
#       # 9ï¸âƒ£ BUILD FRONTEND IMAGE
#       # -----------------------
#       - name: Build frontend image
#         run: |
#           docker build \
#             -t arunkumar885825/frontend:${IMAGE_TAG} \
#             -t arunkumar885825/frontend:latest \
#             .

#       # -----------------------
#       # ðŸ”Ÿ PUSH FRONTEND IMAGE
#       # -----------------------
#       - name: Push frontend image
#         run: |
#           docker push arunkumar885825/frontend:${IMAGE_TAG}
#           docker push arunkumar885825/frontend:latest

#       # -----------------------
#       # 1ï¸âƒ£1ï¸âƒ£ TRIGGER DEPLOYMENT REPO
#       # -----------------------
#       - name: Trigger deployment pipeline
#         run: |
#           curl -X POST \
#             -H "Authorization: token ${{ secrets.DEPLOYMENT_REPO_TOKEN }}" \
#             -H "Accept: application/vnd.github.v3+json" \
#             https://api.github.com/repos/arunkumar-gitacc/deployment/dispatches \
#             -d '{
#               "event_type": "frontend_updated",
#               "client_payload": {
#                 "frontend_tag": "'"${IMAGE_TAG}"'"
#               }
#             }'

# name: Frontend CI + CD (uat / test / demo)

# on:
#   push:
#     branches:
#       - uat
#       - test
#       - demo
#     paths:
#       - "frontend/**"

# permissions:
#   contents: read

# jobs:
#   frontend-ci-cd:
#     runs-on: ubuntu-latest

#     steps:
#       # -----------------------
#       # CHECKOUT CODE
#       # -----------------------
#       - name: Checkout code
#         uses: actions/checkout@v4
#         with:
#           fetch-depth: 0

#       # -----------------------
#       # SET BRANCH NAME
#       # -----------------------
#       - name: Set branch name
#         run: |
#           echo "BRANCH_NAME=${GITHUB_REF##*/}" >> $GITHUB_ENV

#       # -----------------------
#       # LOGIN TO DOCKER HUB
#       # -----------------------
#       - name: Login to Docker Hub
#         uses: docker/login-action@v3
#         with:
#           username: ${{ secrets.DOCKER_USERNAME }}
#           password: ${{ secrets.DOCKER_PASSWORD }}

#       # -----------------------
#       # BUILD FRONTEND IMAGE
#       # -----------------------
#       - name: Build frontend image
#         run: |
#           docker build \
#             -t arunkumar885825/frontend:${BRANCH_NAME} \
#             ./frontend

#       # -----------------------
#       # PUSH FRONTEND IMAGE
#       # -----------------------
#       - name: Push frontend image
#         run: |
#           docker push arunkumar885825/frontend:${BRANCH_NAME}

#       # -----------------------
#       # CD - DEPLOY TO EC2
#       # -----------------------
#       - name: Deploy frontend (branch specific)
#         uses: appleboy/ssh-action@v1.0.3
#         with:
#           host: ${{ secrets.EC2_HOST }}
#           username: ${{ secrets.EC2_USER }}
#           key: ${{ secrets.EC2_SSH_KEY }}
#           script: |
#             set -e
#             echo "ðŸš€ Deploying FRONTEND for branch: ${BRANCH_NAME}"

#             cd /home/ec2-user/${BRANCH_NAME}
#             export BRANCH_NAME=${BRANCH_NAME}

#             docker compose pull frontend
#             docker compose up -d frontend
